datasource db {
  provider = "postgresql" 
}
generator client {
  provider = "prisma-client-js"
}
model Tour {
  id                   String         @id @default(uuid())
  title                String
  overview             String         @db.Text
  duration             String   
  meetingPoint         String
  categories           String[]
  route                String
  startTimes           String[]
  priceTiers           Json           
  wheelchairAccessible Boolean        @default(false)
  supportedAllergies   String[]
  highlights           String[]
  itinerary            Json           
  accessibilityNotes   String[]
  thumbnail            Json           
  gallery              Json           
  introVideoUrl        String?
  schedules            TourSchedule[]
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  deletedAt            DateTime?
  
  @@index([deletedAt])
}

model TourSchedule {
  id               String    @id @default(uuid())
  tourId           String
  tour             Tour      @relation(fields: [tourId], references: [id])
  startTime        DateTime
  maxCapacity      Int
  timeZone         String 
  currentBookings  Int       @default(0)
  status           String    @default("available")
  assignedStaff    String?
  isHoliday        Boolean   @default(false)
  holidaySurcharge Float     @default(0) 
  bookings         Booking[]
  updatedAt        DateTime  @updatedAt
}

model Booking {
  id                    String       @id @default(uuid())
  scheduleId            String
  schedule              TourSchedule @relation(fields: [scheduleId], references: [id])
  tourStartTime         DateTime 
  contactEmail          String
  contactPhone          String
  guestName             String
  guestEmail            String       
  guestPhone            String      
  adultsCount           Int          @default(1)
  childrenCount         Int          @default(0) 
  infantsCount          Int          @default(0)
  selectedTierName      String     
  totalPrice            Float
  paymentStatus         String       @default("unpaid")
  status                String       @default("pending") 
  stripePaymentIntentId String?
  dietaryRequirements   Json         @default("[]") 
  isWheelchairRequired  Boolean      @default(false)
  customerNote          String?      @db.Text
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt 
  deletedAt             DateTime?

  @@index([deletedAt])
  @@index([stripePaymentIntentId]) 
}